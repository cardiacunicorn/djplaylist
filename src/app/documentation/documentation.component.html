<h1 class="text-center">Documentation</h1>
<div id="authentication">
  <h3>Spotify Authentication</h3>
  <p>Spotify requires <code>OAuth 2.0 Authentication</code> to make requests of a user's private playlists. This is acheieved using Node & Express from the serverside; to both protect this app's Spotify <code>clientid</code> and <code>clientsecret</code>, and as a gateway for direct writes to the database when storing access and refresh tokens.</p>
  <h4>OAuth Process:</h4>
  <ol>
    <li>The Angular client requests authentication to begin, by sending the user to <code>/login</code> on the server.</li>
    <li>The server sets a 'State' cookie and permission scopes, and redirects the user to the spotify authorize webpage, asking for their permission.</li>
    <li>Once the user allows these permissions, they are re-directed to <code>/callback</code> on the server.</li>
    <li>The <code>/callback</code> page runs a function that checks the State cookie, to make sure it's the same user & request.</li>
    <li>The State cookie is cleared from the request.</li>
    <li>The returned authorisation code, found in the response, is packaged with this app's clientid and clientsecret. This sensitive information shouldn't be accessible clientside, hence why this process happens serverside.</li>
    <li>The authorisation is sent via <code>HTTP POST</code> to Spotify, and if a (<code>#200</code>) status code is returned, then the access token and refresh token can be found in the Body of the HTTP Response.</li>
    <li>The access token is time limited to 1 hour, but both should be stored in this app's database.</li>
    <li>At this point, the access token can be used to make requests of the Spotify API, specifying endpoints that align with the scope(s) we got permission to access.</li>
    <li>Error handling should exist for an invalid cookie, and similarly any non-(<code>#200</code>) response from Spotify.</li>
    <li>If the access token has expired, the <code>/refresh_token</code> page runs a method on the server that should use the refresh token to generate and save a new access token for the user.</li>
    <li>At this point the user should be re-directed back to the Angular clientside with their <code>access_token</code>, their <code>refresh_token</code> and their <code>Spotify ID</code>.</li>
  </ol>
</div>
<div id="playlists">
  <h3>Playlists</h3>
  <p>Playlists are created and retrieved using the Playlist service in the Angular app.</p>
  <h4>Retrieval</h4>
  <ol>
    <li>When an authorised user navigates to <code>/playlists</code> a request is sent from the service to our API's <code>/api/getmyplaylists</code> endpoint.</li>
    <li>The server retrieves the <code>access_token</code> and makes a check to see if it needs refreshing, before requesting the user's Playlist data from Spotify.</li>
    <li>If the data is retrieved successfully (<code>#200</code>), it is sent back to the Angular app for processing and rendering.</li>
  </ol>
  <h4>Creation</h4>
  <ol>
    <li></li>
  </ol>
</div>
<div id="tracks">
  <h3>Tracks</h3>
  <p>Tracks are retrieved using the Track service in the Angular app.</p>
  <h4>Retrieval</h4>
  <ol>
    <li></li>
  </ol>
  <h4>Reordering</h4>
  <ol>
    <li></li>
  </ol>
</div>
<div id="bugs">
  <h3>Known bugs & errors</h3>
  <ol>
    <li>Some tracks don't have Advanced metrics, so can cause the server to crash e.g. Podcasts, Videos, Local Files</li>
    <li>The error being returned by the server isn't conforming to proper JSON and is throwing a mild error</li>
  </ol>
</div>
